<html>

<head>
    <title>PGPkeygenerator.online - Generate OpenPGP key pair online</title>
    <style>
        body {
            width: 700px;
            margin: auto;
            background: #af85ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #272727;
        }

        textarea {
            resize: none;
            border: 0px;
            padding: 10px;
            border-radius: 15px;
        }

        .button-holder {
            margin: 10px 0px 10px 0px;
        }

        button {
            padding: 10px;
            border-radius: 15px;
            border: 0px;
        }

        #keys-holder {
            padding: 10px;
            border: 0px solid #272727;
            border-radius: 15px;
            background-color: #efefef;
        }

        .copy-button {
            background: linear-gradient(90deg, rgb(255 255 255) 0%, rgb(255 231 47) 0%, rgb(10 0 0) 100%);
            color: white;
        }

        .download-button {
            background: linear-gradient(90deg, rgb(255 255 255) 0%, rgb(255 100 47) 0%, rgb(10 0 0) 100%);
            color: white;
        }

        #title-holder {
            width: 400px;
            margin: auto;
        }
    </style>
</head>

<body>

    <div id="title-holder">
        <h1>PGPkeygenerator.online</h1>
        <p>Generate OpenPGP key pair</p>
    </div>

    <div id="keys-holder">
        <div>
            <label for="private-key-textarea">
                <h3>Private Key</h3>
            </label>
            <div class="button-holder">
                <button class="copy-button" type="button" content="private-key-textarea"
                    onclick="copyToClipboard(this)">Copy</button>
                <button class="download-button" type="button" content="private-key-textarea"
                    onclick="downloadFile(this)">Download File</button>
            </div>
            <textarea id="private-key-textarea" name="private-key-textarea" rows="10" cols="40"></textarea>
        </div>

        <div>
            <label for="public-key-textarea">
                <h3>Public Key</h3>
            </label>
            <div class="button-holder">
                <button class="copy-button" type="button" content="public-key-textarea"
                    onclick="copyToClipboard(this)">Copy</button>
                <button class="download-button" type="button" content="public-key-textarea"
                    onclick="downloadFile(this)">Download File</button>
            </div>
            <textarea id="public-key-textarea" name="public-key-textarea" rows="10" cols="40"></textarea>
        </div>

        <div>
            <label for="revocation-certificate-textarea">
                <h3>Revocation Certificate</h3>
            </label>
            <div class="button-holder">
                <button class="copy-button" type="button" content="revocation-certificate-textarea"
                    onclick="copyToClipboard(this)">Copy</button>
                <button class="download-button" type="button" content="revocation-certificate-textarea"
                    onclick="downloadFile(this)">Download
                    File</button>
            </div>
            <textarea id="revocation-certificate-textarea" name="revocation-certificate-textarea" rows="10"
                cols="40"></textarea>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/openpgp@5.10.1/dist/openpgp.min.js"></script>

    <script>

        const downloadFile = (event) => {

            let textareaName = event.getAttribute('content');

            const link = document.createElement("a");
            const content = document.querySelector("#" + textareaName).value;
            const file = new Blob([content], { type: 'text/plain' });
            link.href = URL.createObjectURL(file);
            link.download = textareaName.replace("-textarea", "") + ".asc";
            link.click();
            URL.revokeObjectURL(link.href);
        };

        const copyToClipboard = (event) => {

            let textareaName = event.getAttribute('content');

            let textarea = document.querySelector("#" + textareaName);

            // Select the text area
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            // Copy the text of textarea
            navigator.clipboard.writeText(textarea.value);

            // Alert the copied text
            alert(textarea.labels[0].textContent.trimStart().trimEnd() + " successfully copied to clipboard.");
        }

        document.addEventListener("DOMContentLoaded", (event) => {

            let privateKeyTextarea = document.querySelector("#private-key-textarea");
            let publicKeyTextarea = document.querySelector("#public-key-textarea");
            let revocationCertificateTextarea = document.querySelector("#revocation-certificate-textarea");

            (async () => {

                const { privateKey, publicKey, revocationCertificate } = await openpgp.generateKey({
                    type: 'ecc', // Type of the key, defaults to ECC
                    curve: 'curve25519', // ECC curve name, defaults to curve25519
                    userIDs: [{ name: 'Jon Smith', email: 'jon@example.com' }], // you can pass multiple user IDs
                    passphrase: 'super long and hard to guess secret', // protects the private key
                    format: 'armored' // output key format, defaults to 'armored' (other options: 'binary' or 'object')
                });

                privateKeyTextarea.value = privateKey;     // '-----BEGIN PGP PRIVATE KEY BLOCK ... '
                publicKeyTextarea.value = publicKey;
                revocationCertificateTextarea.value = revocationCertificate;

            })();

        });

    </script>
</body>

</html>
